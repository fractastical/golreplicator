<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Dimensional Conway's Game of Life with Age Absorption</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        #gameContainer {
            position: relative;
            width: 500px;
            height: 500px;
            margin-top: 20px;
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            border: 1px solid #000;
        }
        #controls {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        button {
            padding: 5px 10px;
            font-size: 14px;
            cursor: pointer;
        }
        #info {
            margin-top: 20px;
            text-align: center;
        }
        #score {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="score">Score: 0</div>
    
    <div id="gameContainer">
        <canvas id="gameCanvas" width="500" height="500"></canvas>
    </div>
    
    <div id="controls">
        <button onclick="switchDimension()">Switch Dimension v 0.129</button>
        <button onclick="addDimension()">Add Dimension</button>
        <button onclick="addPattern('glider')">Add Glider</button>
        <button onclick="addPattern('blinker')">Add Blinker</button>
        <button onclick="addPattern('toad')">Add Toad</button>
        <button onclick="addPattern('beacon')">Add Beacon</button>
        <button onclick="addPattern('spaceship')">Add Spaceship</button>
        <button onclick="increasePropagation()">Increase Propagation Rate</button>
        <button onclick="increaseLifespan()">Increase Lifespan</button>
    </div>

    <div id="info">
        <p>Active Dimension: <span id="activeDimensionDisplay">1</span></p>
        <p>Total Dimensions: <span id="totalDimensionsDisplay">3</span></p>
        <p>Propagation Rate: <span id="propagationRateDisplay">100</span> ms</p>
        <p>Lifespan: <span id="lifespanDisplay">20</span> steps</p>
    </div>

    <script>
    (function() {
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const gridWidth = 50;
        const gridHeight = 50;
        const cellSize = Math.max(10, canvas.width / gridWidth);

        let dimensions = [];
        let activeDimension = 0;
        let numDimensions = 3;

        let steps = 0;
        let propagationRate = 100;
        let lifespan = 20;
        let interval;
        let score = 0;

        const colors = [
            'rgba(255, 0, 0, 1)',   // Red
            'rgba(0, 255, 0, 1)',   // Green
            'rgba(0, 0, 255, 1)',   // Blue
            'rgba(255, 255, 0, 1)', // Yellow
            'rgba(255, 0, 255, 1)', // Magenta
            'rgba(0, 255, 255, 1)'  // Cyan
        ];

        const patterns = {
            glider: [[0, 1], [1, 2], [2, 0], [2, 1], [2, 2]],
            blinker: [[0, 1], [1, 1], [2, 1]],
            toad: [[1, 0], [1, 1], [1, 2], [2, 1], [2, 2], [2, 3]],
            beacon: [[0, 0], [0, 1], [1, 0], [1, 1], [2, 2], [2, 3], [3, 2], [3, 3]],
            spaceship: [[0, 1], [0, 2], [0, 3], [1, 0], [1, 3], [2, 3], [3, 0], [3, 2]]
        };

        function createGrid() {
            return Array(gridHeight).fill().map(() => 
                Array(gridWidth).fill().map(() => ({ alive: false, age: 0 }))
            );
        }

        function initializeDimensions() {
            for (let i = 0; i < numDimensions; i++) {
                dimensions.push({
                    grid: createGrid(),
                    canvas: createCanvas(i),
                    color: colors[i % colors.length]
                });
            }
        }

        function createCanvas(index) {
            const newCanvas = document.createElement('canvas');
            newCanvas.width = canvas.width;
            newCanvas.height = canvas.height;
            newCanvas.style.position = 'absolute';
            newCanvas.style.top = '0';
            newCanvas.style.left = '0';
            newCanvas.style.zIndex = index + 1;
            document.getElementById('gameContainer').appendChild(newCanvas);
            return newCanvas;
        }

        function drawGrid(dimension, index) {
            const ctx = dimension.canvas.getContext('2d');
            ctx.clearRect(0, 0, dimension.canvas.width, dimension.canvas.height);
            const baseColor = dimension.color;
            const alpha = index === activeDimension ? 0.8 : 0.3;
            
            for (let y = 0; y < gridHeight; y++) {
                for (let x = 0; x < gridWidth; x++) {
                    const cell = dimension.grid[y][x];
                    if (cell.alive) {
                        const ageAlpha = Math.min(1, cell.age / 200);
                        const ageHue = (cell.age * 2) % 360;
                        ctx.fillStyle = `hsla(${ageHue}, 100%, 50%, ${alpha * ageAlpha})`;
                        ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
                        
                        ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                        ctx.font = `${Math.max(8, cellSize / 3)}px Arial`;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        
                        const displayAge = cell.age > 999 ? '999+' : cell.age.toString();
                        ctx.fillText(displayAge, (x + 0.5) * cellSize, (y + 0.5) * cellSize);
                    }
                }
            }
        }

        function nextGeneration(grid) {
            const newGrid = createGrid();
            const dyingCells = [];

            for (let y = 0; y < gridHeight; y++) {
                for (let x = 0; x < gridWidth; x++) {
                    const neighbors = countNeighbors(grid, x, y);
                    const currentCell = grid[y][x];
                    if (currentCell.alive) {
                        if (neighbors < 2 || neighbors > 3) {
                            dyingCells.push({x, y, age: currentCell.age});
                            newGrid[y][x] = { alive: false, age: 0 };
                        } else {
                            newGrid[y][x] = { alive: true, age: currentCell.age + 1 };
                        }
                    } else {
                        if (neighbors === 3) {
                            newGrid[y][x] = { alive: true, age: 1 };
                        } else {
                            newGrid[y][x] = { alive: false, age: 0 };
                        }
                    }
                }
            }

            dyingCells.forEach(dyingCell => {
                for (let i = -1; i <= 1; i++) {
                    for (let j = -1; j <= 1; j++) {
                        if (i === 0 && j === 0) continue;
                        const col = (dyingCell.x + i + gridWidth) % gridWidth;
                        const row = (dyingCell.y + j + gridHeight) % gridHeight;
                        if (newGrid[row][col].alive) {
                            newGrid[row][col].age += Math.floor(dyingCell.age / 8);
                        }
                    }
                }
            });

            return newGrid;
        }

        function countNeighbors(grid, x, y) {
            let sum = 0;
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    if (i === 0 && j === 0) continue;
                    const col = (x + i + gridWidth) % gridWidth;
                    const row = (y + j + gridHeight) % gridHeight;
                    sum += grid[row][col].alive ? 1 : 0;
                }
            }
            return sum;
        }

        function calculateScore(dimensions) {
            return dimensions.reduce((totalScore, dimension) => {
                return totalScore + dimension.grid.flat().reduce((sum, cell) => {
                    if (cell.alive) {
                        return sum + Math.pow(cell.age, 1.5);
                    }
                    return sum;
                }, 0);
            }, 0);
        }

        function stepGame() {
            dimensions.forEach((dimension, index) => {
                dimension.grid = nextGeneration(dimension.grid);
                drawGrid(dimension, index);
            });
            steps++;
            score = Math.floor(calculateScore(dimensions));
            document.getElementById('score').textContent = `Score: ${score}`;
        }

        function startGame() {
            clearInterval(interval);
            interval = setInterval(stepGame, propagationRate);
        }

        function pauseGame() {
            clearInterval(interval);
        }

        function restartGame() {
            pauseGame();
            startGame();
        }

        function updateInfo() {
            document.getElementById('activeDimensionDisplay').textContent = activeDimension + 1;
            document.getElementById('totalDimensionsDisplay').textContent = numDimensions;
            document.getElementById('propagationRateDisplay').textContent = propagationRate;
            document.getElementById('lifespanDisplay').textContent = lifespan;
        }

        initializeDimensions();
        startGame();
        updateInfo();

        window.switchDimension = function() {
            activeDimension = (activeDimension + 1) % numDimensions;
            dimensions.forEach((dimension, index) => drawGrid(dimension, index));
            updateInfo();
        };

        window.addDimension = function() {
            if (numDimensions < colors.length) {
                const newDimension = {
                    grid: createGrid(),
                    canvas: createCanvas(numDimensions),
                    color: colors[numDimensions % colors.length]
                };
                dimensions.push(newDimension);
                numDimensions++;
                updateInfo();
            } else {
                alert("Maximum number of dimensions reached");
            }
        };

        window.addPattern = function(patternName) {
            const pattern = patterns[patternName];
            const randX = Math.floor(Math.random() * (gridWidth - 5));
            const randY = Math.floor(Math.random() * (gridHeight - 5));
            
            pattern.forEach(([dx, dy]) => {
                const x = (randX + dx) % gridWidth;
                const y = (randY + dy) % gridHeight;
                dimensions[activeDimension].grid[y][x] = { alive: true, age: 1 };
            });
            
            drawGrid(dimensions[activeDimension], activeDimension);
            score = Math.floor(calculateScore(dimensions));
            document.getElementById('score').textContent = `Score: ${score}`;
        };

        window.increasePropagation = function() {
            propagationRate = Math.max(50, propagationRate - 20);
            restartGame();
            updateInfo();
        };

        window.increaseLifespan = function() {
            lifespan += 5;
            updateInfo();
        };

    })();
    </script>
</body>
</html>
